{% extends 'basic.html' %}
{% load static %}

{% block title %}
Update Book - LeafyReads Admin
{% endblock title %}

{% block css %}
<link rel="stylesheet" href="{% static 'css/addBook.css' %}" />
{% endblock %}

{% block body %}

<div class="addbookcontainer">
    <h1>Update Book - Admin</h1>
    <form method="POST" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="form-actions">
            <button type="submit" name="action" value="save" class="btn-primary">Save</button>
            <button type="submit" name="action" value="continue" class="btn-secondary">Save and Continue Editing</button>
        </div>

    <div class="split-layout" >
        <!-- Left side: book info -->
        <div class="form-left">
            <div style="margin-bottom: 10px;">
                <label for="title">Title</label>
                <input type="text" name="title" id="title" value="{{ book.title }}" placeholder="Enter book title">
            </div>

            <div style="margin-bottom: 10px;">
                <label for="slug">Slug</label>
                <input type="text" name="slug" id="slug" value="{{ book.slug }}" placeholder="book-title-slug">
            </div>

            <div style="margin-bottom: 10px;">
                <label for="author">Author</label>
                <input type="text" name="author" id="author" value="{{ book.author }}" placeholder="Enter author name">
            </div>

            <div style="margin-bottom: 10px;">
                <label for="genre">Genre</label>
                <select id="genre" name="genre">
                    <option value="">-- Select genre --</option>
                    {% for g in genres %}
                        <option value="{{ g.id }}" {% if book.genre and book.genre.id == g.id %}selected{% endif %}>
                            {{ g.name }}
                        </option>
                    {% endfor %}
                </select>
            </div>

            <div style="margin-bottom: 10px;">
                <label for="price">Price</label>
                <input type="number" name="price" id="price" value="{{ book.price }}" placeholder="Enter price">
            </div>

            <div style="margin-bottom: 10px;">
                <label for="isbn">ISBN</label>
                <input type="text" name="isbn" id="isbn" value="{{ book.isbn }}" placeholder="Enter ISBN number">
            </div>

            <label for="original_cover">Front Cover</label>
            <div class="image-upload">
                {% if book.cover_front %}
                    <img id="preview" src="{{ book.cover_front.url }}" alt="Cover Front">
                    <input type="hidden" id="original_cover" value="{{ book.cover_front.url }}">
                {% else %}
                    <img id="preview" src="https://via.placeholder.com/250x150?text=No+Cover" alt="Cover Front">
                    <input type="hidden" id="original_cover" value="https://via.placeholder.com/250x150?text=No+Cover">
                {% endif %}

                <!-- Camera icon -->
                <label for="cover" class="overlay">ðŸ“·</label>
                <input type="file" id="cover" name="cover_front" accept="image/*" onchange="previewImage(event)">
                <!-- Remove/Undo button -->
                <button type="button" class="remove-btn" onclick="resetImage()">X</button>
            </div>

            <div class="checkbox">
                <label style="color: white;" for="published">Is Published</label>
                <input type="checkbox" name="is_published" id="published" {% if book.is_published %}checked{% endif %}>
            </div>

            <div class="file-input">
                <label for="audio">Audio File</label>
                <input type="file" name="audio_file" id="audio">
            </div>
        </div>

        <!-- Right side: book content -->
         
        <div class="form-right">
           
            {{ form.media }}
            <label for="bookContent">Book Content</label>

            {{ form.content }}
            {{ form.content.errors }}

            <div class="form-actions">
                <button type="submit" name="action" value="save" class="btn-primary">Save</button>
                <button type="submit" name="action" value="continue" class="btn-secondary">Save and Continue Editing</button>
            </div>

        </div>
    </form>
    </div>
</div>

<script>
function previewImage(event) {
    const reader = new FileReader();
    reader.onload = function() {
        document.getElementById('preview').src = reader.result;
    }
    reader.readAsDataURL(event.target.files[0]);
}

function resetImage() {
    // restore original cover
    const original = document.getElementById('original_cover').value;
    document.getElementById('preview').src = original;
    document.getElementById('cover').value = ""; // clear the new file input
}
</script>
{% endblock body %}
