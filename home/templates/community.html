{% extends 'base.html' %}
{% load static %}

{% block title %}
Community - LeafyReads
{% endblock %}

{% block css %}
<style>
    /* --- COMMUNITY PAGE STYLES --- */

    .reveal {
        opacity: 0;
        transform: translateY(40px);
        transition: opacity 1s cubic-bezier(0.165, 0.84, 0.44, 1), transform 1s cubic-bezier(0.165, 0.84, 0.44, 1);
    }

    .reveal.visible {
        opacity: 1;
        transform: translateY(0);
    }

    /* --- Hero Section --- */
    .community-hero {
        text-align: center;
        background-color: var(--color-bg);
        background-image: radial-gradient(circle at 10% 20%, rgb(136 176 224 / .1), transparent 30%), radial-gradient(circle at 90% 80%, rgb(224 136 176 / .1), transparent 30%);
        transition: background-color 0.3s ease;
        animation: heroBgPulse 8s infinite alternate ease-in-out
    }

    .community-hero h1 {
        font-size: 3.25rem;
        font-weight: 800;
        color: var(--color-hero-heading);
        margin-bottom: 1.5rem;
        letter-spacing: -0.04em;
    }

    .community-hero p {
        font-size: 1.25rem;
        color: var(--color-text-medium);
        max-width: 50rem;
        margin: 0 auto;
        line-height: 1.7;
    }

    /* --- Main Community Layout with Sticky Sidebars --- */
    .community-layout {
        padding: 4rem 0;
        display: grid;
        grid-template-columns: 1fr;
        gap: 2.5rem;
        align-items: flex-start;
        /* Important for sticky positioning */
    }

    @media (min-width: 1024px) {
        .community-layout {
            grid-template-columns: 280px 1fr 280px;
        }
    }

    /* --- Sidebar Styles --- */
    .sidebar {
        position: sticky;
        top: 2rem;
    }

    .sidebar .widget {
        background-color: var(--color-card-bg);
        border: 1px solid var(--color-border);
        border-radius: 0.75rem;
        padding: 1.5rem;
        margin-bottom: 2rem;
    }

    .sidebar .widget-title {
        font-size: 1.1rem;
        font-weight: 600;
        margin-bottom: 1.5rem;
        padding-bottom: 0.75rem;
        border-bottom: 1px solid var(--color-border);
    }

    .sidebar ul {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .sidebar ul li a {
        display: flex;
        align-items: center;
        padding: 0.75rem 0;
        color: var(--color-text-medium);
        transition: color 0.3s ease;
    }

    .sidebar ul li a:hover {
        color: var(--color-primary);
    }

    .sidebar ul li a i {
        margin-right: 0.75rem;
        width: 20px;
        height: 20px;
    }

    /* --- Center Feed Styles --- */
    .main-feed {
        display: flex;
        flex-direction: column;
        gap: 2rem;
    }

    /* --- Interactive Create Post Widget --- */
    .create-post-widget {
        background-color: var(--color-white);
        border: 1px solid var(--color-border);
        border-radius: 0.75rem;
        padding: 1.5rem;
        transition: all 0.3s ease-in-out;
    }

    .create-post-main {
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .create-post-main img {
        width: 48px;
        height: 48px;
        border-radius: 50%;
    }

    .create-post-input {
        flex-grow: 1;
        border: 1px solid var(--color-border);
        border-radius: 24px;
        padding: 0.75rem 1.25rem;
        color: var(--color-text-light);
        cursor: pointer;
        transition: background-color 0.3s ease;
    }

    .create-post-input:hover {
        background-color: var(--color-card-bg);
    }

    .post-textarea {
        display: none;
        width: 100%;
        min-height: 100px;
        border: 1px solid var(--color-border);
        border-radius: 0.5rem;
        padding: 1rem;
        font-family: inherit;
        font-size: 1rem;
        resize: vertical;
        margin-top: 1rem;
    }

    .create-post-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 1rem;
        padding-top: 1rem;
        border-top: 1px solid var(--color-border);
    }

    .create-post-actions {
        display: flex;
        justify-content: space-around;
        flex-grow: 1;
    }

    .create-post-widget.is-expanded .create-post-actions {
        flex-grow: 0;
    }

    .create-post-actions a {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        color: var(--color-text-medium);
        font-weight: 500;
        padding: 0.5rem 1rem;
        border-radius: 0.5rem;
        transition: background-color 0.3s ease, color 0.3s ease;
    }

    .create-post-actions a:hover {
        background-color: var(--color-card-bg);
        color: var(--color-primary);
    }

    .expanded-buttons {
        display: none;
        gap: 0.5rem;
    }

    .create-post-widget.is-expanded .create-post-input {
        display: none;
    }

    .create-post-widget.is-expanded .create-post-main {
        align-items: flex-start;
    }

    .create-post-widget.is-expanded .post-textarea {
        display: block;
    }

    .create-post-widget.is-expanded .expanded-buttons {
        display: flex;
    }

    .secondary-btn {
        background-color: var(--color-card-bg);
        color: var(--color-text-medium);
        border: 1px solid var(--color-border);
        padding: 0.6rem 1.2rem;
        font-weight: 500;
    }

    .secondary-btn:hover {
        background-color: var(--color-border);
    }

    /* --- Refined Post Card --- */
    .post-card {
        background-color: var(--color-white);
        border: 1px solid var(--color-border);
        border-radius: 0.75rem;
        overflow: hidden;
        transition: box-shadow 0.3s ease;
    }

    .post-card:hover {
        box-shadow: 0 10px 20px -5px rgba(0, 0, 0, 0.07);
    }

    .post-header {
        display: flex;
        align-items: center;
        padding: 1rem 1.5rem;
    }

    .post-header img {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        margin-right: 1rem;
    }

    .post-author-info .name {
        font-weight: 600;
        color: var(--color-text-dark);
    }

    .post-author-info .timestamp {
        font-size: 0.8rem;
        color: var(--color-text-light);
    }

    .post-content {
        padding: 0 1.5rem 1rem;
    }

    .post-content h3 {
        font-size: 1.3rem;
        font-weight: 600;
        margin-bottom: 0.75rem;
    }

    .post-content p {
        color: var(--color-text-medium);
        line-height: 1.6;
    }

    .post-cover-image {
        width: 100%;
        max-height: 400px;
        object-fit: cover;
        margin: 0.5rem 0 1rem;
        border-radius: 0.5rem;
        border: 1px solid var(--color-border);
    }

    .post-footer {
        display: flex;
        justify-content: flex-end;
        align-items: center;
        padding: 1rem 1.5rem;
        border-top: 1px solid var(--color-border);
    }

    .post-actions {
        display: flex;
        gap: 1.5rem;
    }

    .post-actions a {
        display: flex;
        align-items: center;
        color: var(--color-text-light);
        transition: color 0.3s ease, transform 0.2s ease;
        cursor: pointer;
    }

    .post-actions a:hover {
        color: var(--color-primary);
        transform: scale(1.1);
    }

    .post-actions a i {
        margin-right: 0.5rem;
        width: 18px;
        height: 18px;
    }

    /* --- Comment Section --- */
    .comment-section {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.5s ease-in-out, padding 0.5s ease-in-out;
        padding: 0 1.5rem;
        background-color: var(--color-card-bg);
    }

    .comment-section.is-visible {
        max-height: 1000px;
        /* Large enough value */
        padding: 1.5rem;
        border-top: 1px solid var(--color-border);
    }

    .comment-item {
        display: flex;
        gap: 1rem;
        margin-bottom: 1.5rem;
    }

    .comment-item img {
        width: 36px;
        height: 36px;
        border-radius: 50%;
    }

    .comment-body .name {
        font-weight: 600;
        margin-bottom: 0.25rem;
    }

    .add-comment {
        display: flex;
        gap: 1rem;
        margin-top: 1.5rem;
        padding-top: 1.5rem;
        border-top: 1px solid var(--color-border);
    }

    .add-comment img {
        width: 36px;
        height: 36px;
        border-radius: 50%;
    }

    .add-comment input {
        flex-grow: 1;
        border: 1px solid var(--color-border);
        border-radius: 18px;
        padding: 0.5rem 1rem;
        font-family: inherit;
    }
</style>
{% endblock %}

{% block body %}

<main>
    <!-- Hero Section -->
    <section class="community-hero">
        <div class="container reveal">
            <h1>Welcome to the Reading Room</h1>
            <p>This is your space to connect with fellow book lovers, share your thoughts on the latest reads, join
                vibrant discussions, and discover your next favorite story together.</p>
        </div>
    </section>

    <!-- Main Community Layout -->
    <div class="container">
        <div class="community-layout">
            <!-- Left Sidebar -->
            <aside class="sidebar reveal">
                <div class="widget">
                    <h3 class="widget-title">Popular Book Clubs</h3>
                    <ul>
                        <li><a href="#"><i data-lucide="swords"></i> Fantasy & Sci-Fi Guild</a></li>
                        <li><a href="#"><i data-lucide="heart-pulse"></i> Modern Romance Readers</a></li>
                        <li><a href="#"><i data-lucide="scroll"></i> The Classics Corner</a></li>
                        <li><a href="#"><i data-lucide="search"></i> Thriller & Mystery Fans</a></li>
                    </ul>
                </div>
                <div class="widget">
                    <h3 class="widget-title">Top Contributors</h3>
                    <ul>
                        <li><a href="#"><i data-lucide="user-check"></i> Sarah K.</a></li>
                        <li><a href="#"><i data-lucide="user-check"></i> Michael B.</a></li>
                        <li><a href="#"><i data-lucide="user-check"></i> David Chen</a></li>
                    </ul>
                </div>
            </aside>

            <!-- Center Feed -->
            <section style="padding: 0;" class="main-feed reveal">
                <!-- Create Post Widget -->
                <div id="create-post-widget" class="create-post-widget">
                    <div class="create-post-main">
                        <img src="https://i.pravatar.cc/150?u=a042581f4e29026704d" alt="Your avatar">
                        <div id="create-post-input" class="create-post-input">Start a discussion, ask a question...
                        </div>
                        <textarea id="post-textarea" class="post-textarea"
                            placeholder="What's on your mind? Use @ to mention a book or user."></textarea>
                    </div>
                    <div class="create-post-footer">
                        <div class="create-post-actions">
                            <a href="#"><i data-lucide="book-plus"></i> Add a Book</a>
                            <a href="#"><i data-lucide="image"></i> Upload Photo</a>
                            <a href="#"><i data-lucide="file-text"></i> Write Article</a>
                        </div>
                        <div id="expanded-buttons" class="expanded-buttons">
                            <button id="cancel-post-btn" class="btn secondary-btn">Cancel</button>
                            <button class="btn primary-btn">Post</button>
                        </div>
                    </div>
                </div>

                <!-- Post 1 -->
                <div class="post-card">
                    <div class="post-header">
                        <img src="https://i.pravatar.cc/150?img=1" alt="Avatar">
                        <div class="post-author-info">
                            <span class="name">Sarah K.</span>
                            <span class="timestamp">Posted 2 hours ago</span>
                        </div>
                    </div>
                    <div class="post-content">
                        <h3>Just finished "Project Hail Mary" and I'm speechless!</h3>
                        <img class="post-cover-image"
                            src="https://images.unsplash.com/photo-1592496431122-2349e0fbc666?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto-format&fit=crop&w=1287&q=80"
                            alt="Book cover">
                        <p>Andy Weir has done it again. The science, the friendship, the humor... it's a masterpiece.
                            Has anyone else read it? I have so many thoughts I need to discuss!</p>
                    </div>
                    <div class="post-footer">
                        <div class="post-actions">
                            <a class="like-btn"><i data-lucide="heart"></i> 128</a>
                            <a class="toggle-comments"><i data-lucide="message-square"></i> 32</a>
                        </div>
                    </div>
                    <div class="comment-section">
                        <div class="comment-item">
                            <img src="https://i.pravatar.cc/150?img=2" alt="Avatar">
                            <div class="comment-body">
                                <p class="name">Michael B.</p>
                                <p>It's on my to-read list! You're making me want to bump it to the top.</p>
                            </div>
                        </div>
                        <div class="add-comment">
                            <img src="https://i.pravatar.cc/150?u=a042581f4e29026704d" alt="Your avatar">
                            <input type="text" placeholder="Write a comment...">
                        </div>
                    </div>
                </div>

                <!-- Post 2 -->
                <div class="post-card">
                    <div class="post-header">
                        <img src="https://i.pravatar.cc/150?img=2" alt="Avatar">
                        <div class="post-author-info">
                            <span class="name">Michael B.</span>
                            <span class="timestamp">Posted yesterday</span>
                        </div>
                    </div>
                    <div class="post-content">
                        <h3>Looking for recommendations: Best fantasy series of the last 5 years?</h3>
                        <p>I've finished The Stormlight Archive and need something new to sink my teeth into. Open to
                            anything from epic fantasy to urban fantasy. What are your must-reads?</p>
                    </div>
                    <div class="post-footer">
                        <div class="post-actions">
                            <a class="like-btn"><i data-lucide="heart"></i> 97</a>
                            <a class="toggle-comments"><i data-lucide="message-square"></i> 58</a>
                        </div>
                    </div>
                    <div class="comment-section">
                        <div class="add-comment">
                            <img src="https://i.pravatar.cc/150?u=a042581f4e29026704d" alt="Your avatar">
                            <input type="text" placeholder="Add a recommendation...">
                        </div>
                    </div>
                </div>

            </section>

            <!-- Right Sidebar -->
            <aside class="sidebar reveal">
                <div class="widget">
                    <h3 class="widget-title">Trending Books</h3>
                    <ul>
                        <li><a href="#"><i data-lucide="book"></i> The Midnight Library</a></li>
                        <li><a href="#"><i data-lucide="book"></i> Dune</a></li>
                        <li><a href="#"><i data-lucide="book"></i> Klara and the Sun</a></li>
                    </ul>
                </div>
                <div class="widget">
                    <h3 class="widget-title">Upcoming Events</h3>
                    <ul>
                        <li><a href="#"><i data-lucide="calendar"></i> Author Q&A: N.K. Jemisin</a></li>
                        <li><a href="#"><i data-lucide="calendar"></i> Sci-Fi Guild: "Dune" Discussion</a></li>
                    </ul>
                </div>
            </aside>
        </div>
    </div>
</main>

<script>
    // --- Script for scroll animations ---
    document.addEventListener('DOMContentLoaded', () => {
        const revealElements = document.querySelectorAll('.reveal');
        if (revealElements.length) {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('visible');
                        observer.unobserve(entry.target);
                    }
                });
            }, {
                threshold: 0.1
            });

            revealElements.forEach(el => {
                observer.observe(el);
            });
        }

        // --- Script for interactive post widget ---
        const postWidget = document.getElementById('create-post-widget');
        if (postWidget) {
            const postInput = document.getElementById('create-post-input');
            const postTextarea = document.getElementById('post-textarea');
            const cancelBtn = document.getElementById('cancel-post-btn');

            postInput.addEventListener('click', () => {
                postWidget.classList.add('is-expanded');
                postTextarea.focus();
            });

            cancelBtn.addEventListener('click', () => {
                postWidget.classList.remove('is-expanded');
                postTextarea.value = '';
            });
        }

        // --- Script for toggling comment sections ---
        const commentToggles = document.querySelectorAll('.toggle-comments');
        commentToggles.forEach(toggle => {
            toggle.addEventListener('click', (event) => {
                event.preventDefault();
                const postCard = toggle.closest('.post-card');
                const commentSection = postCard.querySelector('.comment-section');
                commentSection.classList.toggle('is-visible');
            });
        });
    });
</script>

{% endblock %}