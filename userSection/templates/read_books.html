{% extends 'base.html' %} 
{% load static %}
{% load cloudinary %}

{% block title %}
Books Read | LeafyReads
{% endblock %}

{% block css %}
<link rel="stylesheet" href="{% static 'css/mobilehome.css' %}" />
<link rel="stylesheet" href="{% static 'css/library.css' %}" />
{% endblock %}

{% block body %}
{% include 'login.html' %}

<section class="bg-white" style="min-height: 80vh; padding-top: 2rem;">
    <div class="container bookscontainer">
        
        <div class="section-header">
            <h2 style="font-size: 1.8rem;">Books You've Read ðŸ“š</h2>
            <p>Your journey through stories.</p>
        </div>

        {% if books %}
        <div class="books-grid">
            {% for item in books %}
            <div class="book-item" style="position: relative;">
                <a href="{% url 'book' item.book.slug %}">
                    
                    {% if item.book.cover_front %}
                        <img class="imgbook" src="{{ item.book.cover_front.url }}?q=auto&f_auto" alt="{{ item.book.title }}" loading="lazy" 
                             style="object-fit: cover;" />
                    {% else %}
                         <img class="imgbook" src="https://placehold.co/400x600/cccccc/ffffff?text=No+Cover" alt="No Cover" loading="lazy" />
                    {% endif %}
                    
                    {% cloudinary "rpy7fckyfzgkmnftr6ln" loading="lazy" quality="auto" fetch_format="auto" style="position: absolute;left: -4px;top: -2px;box-shadow: none;width: 102%;height: 82%;" alt="frame" %}
                    
                    <div style="box-shadow: 1px 1px 1px #5a5a5a38;border-radius: 0px 0px 5px 5px;">
                        <div class="readby">
                            <h3 class="truncate">{{ item.book.title }}</h3>
                            <div class="views">
                                <h4>{{ item.book.views_count }}</h4> <i style="width: 16px;" data-lucide="eye"></i>
                            </div>
                        </div>
                        <div style="display: flex;justify-content: space-between;align-items: center;" class="truncate">
                            <p><span style="font-weight: 700;">by:</span> {{ item.book.author }}</p>
                            <div style="font-size: 14px;align-items: center;display: flex;margin-right: 5px;">
                                <span style="font-size: 0.8em; color: #666;">{{ item.readed_at|date:"M d, Y" }}</span>
                            </div>
                        </div>
                    </div>
                </a>
            </div>
            {% endfor %}
        </div>

        {% if books.paginator.num_pages > 1 %}
        <div class="pagination">
            {% if books.has_previous %}
            <a href="?page={{ books.previous_page_number }}" class="page-btn">Previous</a>
            {% else %}
            <span class="page-btn disabled">Previous</span>
            {% endif %}

            {% for num in books.paginator.page_range %}
                {% if num >= books.number|add:'-2' and num <= books.number|add:'2' %}
                    {% if books.number == num %}
                    <span class="page-btn current">{{ num }}</span>
                    {% else %}
                    <a href="?page={{ num }}" class="page-btn">{{ num }}</a>
                    {% endif %}
                {% endif %}
            {% endfor %}

            {% if books.has_next %}
            <a href="?page={{ books.next_page_number }}" class="page-btn">Next</a>
            {% else %}
            <span class="page-btn disabled">Next</span>
            {% endif %}
        </div>
        {% endif %}

        {% else %}
        <div class="fallback-modern">
            <div class="fallback-card">
                {% cloudinary "qfqb3sloiyybtxa4nolh" class="fallback-icon" loading="lazy" alt="Empty List" %}
                <h2 style="color: inherit;">No books read yet</h2>
                <p>Start reading to fill up your history!</p>
                <a href="{% url 'library' %}" class="fallback-link">Explore Library</a>
            </div>
        </div>
        {% endif %}

    </div>
</section>
{% endblock %}