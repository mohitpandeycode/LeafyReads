{% extends 'base.html' %}
{% load static %}

{% block title %}
 {{title}}- find all the varity of books here
{% endblock %}

{% block css %}
  <link rel="stylesheet" href="{% static 'css/library.css' %}" />
{% endblock %}

{% block body %}

<!-- loginpage-->
{% include 'login.html' %}
  <section class="bg-white">
    <div class="container">
        {% if search and not books%}
        <div class="fallback-modern">
          <div class="fallback-card">
            <img class="fallback-icon" src="https://cdn-icons-png.flaticon.com/512/4076/4076549.png" loading="lazy" alt="No books" />
            <h2>Oops! No books here yet...</h2>
            <p>Hmm... Looks like we couldn’t find anything for <strong>"{{ search }}"</strong> search results:(</p>
            <a href="{% url 'library' %}" class="fallback-link">Explore Library</a>
          </div>
        </div>
      {% elif not books %}
        <div class="fallback-modern">
          <div class="fallback-card">
            <img class="fallback-icon" src="https://cdn-icons-png.flaticon.com/512/4076/4076549.png" loading="lazy" alt="No books" />
            <h2>Oops! No books here yet...</h2>
            <p>Looks like this category is still waiting for its first book.</p>
            <a href="{% url 'library' %}" class="fallback-link">Explore Library</a>
          </div>
        </div>
      {% else %}
        <div class="section-header">
          
          {% if search %}
          <h2 style="font-size: 1.8rem;">Search results for <u>{{search}}</u> book</h2>
          {% else %}
          <h2 style="font-size: 1.8rem;">Explore the Collection {{category}}</h2>
          {% endif %}
          <p>A vast range of books curated just for you.</p>
        </div>
        <div class="books-grid">
          {% for book in books %}
            <div class="book-item">
              <a href="{% url 'book' book.slug %}">
                <img src="{{ book.cover_front.url }}" alt="Book Cover 1" loading="lazy" onerror="this.onerror=null;this.src='https://placehold.co/400x600/cccccc/ffffff?text=Image+Failed';" />
                <div style="box-shadow: 2px 2px 3px #3a3a3a38;border-radius: 0px 0px 5px 5px;">
                  <h3 class="truncate">{{ book.title }}</h3>
                  <p class="truncate">
                    <span style="font-weight: 700;">by:</span> {{ book.author }}
                  </p>
                  <div style="padding: 5px 0px; display: flex;justify-content: space-between;align-items: center;">
                    <p class="truncate">
                      <span style="font-weight: 700;">type:</span> {{ book.genre }}
                    </p>
                    <p>4.3⭐</p>
                  </div>
                </div>
              </a>
            </div>
          {% endfor %}
        </div>
        {% endif %}
      </div>
        {% if books.paginator.num_pages > 1 %}
          <div class="pagination">
              {% if books.has_previous %}
                  <a href="?page={{ books.previous_page_number }}" class="page-btn">Previous</a>
              {% else %}
                  <span class="page-btn disabled">Previous</span>
              {% endif %}

              <!-- First page -->
              {% if books.number > 3 %}
                  <a href="?page=1" class="page-btn">1</a>
                  <span class="dots">...</span>
              {% endif %}

              <!-- Pages near current page -->
              {% for num in books.paginator.page_range %}
                  {% if num >= books.number|add:'-2' and num <= books.number|add:'2' %}
                      {% if books.number == num %}
                          <span class="page-btn current">{{ num }}</span>
                      {% else %}
                          <a href="?page={{ num }}" class="page-btn">{{ num }}</a>
                      {% endif %}
                  {% endif %}
              {% endfor %}

              <!-- Last page -->
              {% if books.number < books.paginator.num_pages|add:'-2' %}
                  <span class="dots">...</span>
                  <a href="?page={{ books.paginator.num_pages }}" class="page-btn">{{ books.paginator.num_pages }}</a>
              {% endif %}

              {% if books.has_next %}
                  <a href="?page={{ books.next_page_number }}" class="page-btn">Next</a>
              {% else %}
                  <span class="page-btn disabled">Next</span>
              {% endif %}
          </div>
{% endif %}



  </section>
{% endblock %}

{% block script %}
{% endblock %}
